<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>זמני תפילות - יום חול</title>

  <!-- פונט מודרני ונקי -->
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;800&display=swap" rel="stylesheet" />

  <style>
    :root{
      --brand:#8b1538; --brand-2:#d2691e;
      --bg-1:#f5f1e8; --bg-2:#f8f4eb; --panel:#f7f2eb;
      --ink:#251a1a; --ink-2:#7b1f3a; --radius:16px;
      --shadow-lg:0 6px 16px rgba(0,0,0,.16);
      --shadow-sm:0 3px 12px rgba(0,0,0,.08);
    }
    *,*::before,*::after{box-sizing:border-box}
    body{
      margin:0; color:var(--ink);
      font-family:'Assistant',system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans";
      background:linear-gradient(135deg,var(--bg-1),var(--bg-2));
    }
    .h1{
      font-weight:800;color:#fff;letter-spacing:.02em;
      font-size:clamp(22px,4.6vw,50px);
    }

    .poster{
      min-height:100dvh; display:grid;
      grid-template-rows:auto 1fr auto; gap:16px;
      padding:2vh 3vw; background:#fffdf9;
    }
    header.site-header{
      display:grid; place-items:center; text-align:center;
      background:var(--brand); border:3px solid var(--brand-2);
      border-radius:16px; padding:1rem 1.2rem; box-shadow:var(--shadow-lg);
    }

    .grid-wrapper{
      display:grid; gap:clamp(12px,2vw,28px); align-content:start;
    }
    /* עמודות רספונסיביות: 1/2/3 */
    @media (max-width:640px){ .grid-wrapper{ grid-template-columns:1fr; } }
    @media (min-width:641px) and (max-width:1024px){ .grid-wrapper{ grid-template-columns:repeat(2,1fr); } }
    @media (min-width:1025px){ .grid-wrapper{ grid-template-columns:repeat(3,1fr); } }

    .column{
      background:var(--panel); padding:clamp(12px,2vh,24px);
      border-radius:16px; border:2px solid #e3c5ad; box-shadow:var(--shadow-sm);
      display:grid; grid-template-rows:auto 1fr; align-items:start;
    }

    /* כותרת עמודה – ממורכזת וגדולה */
    .h2{
      font-weight:800; color:var(--ink-2);
      text-align:center; margin:0 0 .6rem;
      font-size:clamp(22px,2.8vw,32px);
    }

    .times{
      list-style:none; width:100%;
      display:grid; grid-auto-rows:minmax(38px,auto);
      gap:8px; margin:0; padding:0; height:100%;
      align-content:space-between;
    }
    .time-item{
      display:grid; place-items:center;
      border-radius:12px; padding:.55rem .7rem;
      background:#ffffffa6; border:1px dashed #e7d7c7;
      font-size: clamp(23px,2.4vw,30px);font-weight: 600;
      color:var(--ink-2);
    }

    footer.site-footer{
      text-align:center; background:var(--brand); color:#fff;
      border:3px solid var(--brand-2); border-radius:16px;
      padding:.9rem; box-shadow:var(--shadow-lg); font-weight:800;
      font-size:clamp(14px,1.8vw,22px);
    }

    /* מצב כהה */
    @media (prefers-color-scheme: dark){
      :root{ --bg-1:#2a2321; --bg-2:#3a312f; --panel:#2f2a29; --ink:#f9f7f4; }
      body{ background:linear-gradient(135deg,var(--bg-1),var(--bg-2)); }
      .column{ border-color:#5a3a2a; }
      .time-item{ background:#00000022; border-color:#ffffff22; }
    }

    /* הדפסה A4 */
    @media print{
      @page{ size:A4 portrait; margin:10mm }
      body{ background:#fff }
      .poster{ background:#fff; min-height:auto; gap:8px; padding:0 }
      header.site-header, footer.site-footer{ box-shadow:none; -webkit-print-color-adjust:exact; print-color-adjust:exact }
    }
  </style>
</head>
<body>
  <div class="poster" role="document">
    <header class="site-header" role="banner" aria-label="כותרת ראשית">
      <h1 class="h1">בית הכנסת חב״ד — זמני התפילות יום חול</h1>
    </header>

    <main role="main">
      <div class="grid-wrapper" id="grid"><!-- נטען דינמית --></div>
    </main>

    <footer class="site-footer" role="contentinfo">
      אסור לדבר בשעת התפילה וקריאת התורה
    </footer>
  </div>

  <script>
    /* מזהים של הגיליון */
    const SHEET_ID = "1utQ6ndVedwFHoSua02o0w8sGUrsH5ztNL_EzfcqiiK8";
    const GID      = 350737418;
    const GVIZ_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${GID}`;

    /* טעינת GViz כ-<script> (JSONP) */
    function loadGvizTable(url){
      return new Promise((resolve, reject) => {
        const tsUrl = url + "&t=" + Date.now();
        const prev = (window.google && window.google.visualization &&
                      window.google.visualization.Query &&
                      window.google.visualization.Query.setResponse)
                   ? window.google.visualization.Query.setResponse : null;

        window.google = window.google || {};
        window.google.visualization = window.google.visualization || {};
        window.google.visualization.Query = window.google.visualization.Query || {};
        window.google.visualization.Query.setResponse = (resp) => {
          try{
            if (!resp || resp.status !== 'ok') { reject(new Error('GViz response error')); return; }
            resolve(resp.table);
          } finally {
            if (prev) window.google.visualization.Query.setResponse = prev;
            script.remove();
          }
        };

        const script = document.createElement('script');
        script.src = tsUrl;
        script.onerror = () => { if (prev) window.google.visualization.Query.setResponse = prev;
          reject(new Error('GViz script load error')); };
        document.body.appendChild(script);
      });
    }

    /* עזר */
    function cellValue(c){ return (!c) ? "" : (c.f!=null ? c.f : (c.v==null ? "" : c.v)); }

    /* בניית כרטיס עמודה */
    function createColumn(section){
      const wrap = document.createElement('section');
      wrap.className = 'column';

      const h2 = document.createElement('h2');
      h2.className = 'h2';
      h2.textContent = section.title;

      const ul = document.createElement('ul');
      ul.className = 'times';

      (section.items || []).forEach(txt => {
        const li = document.createElement('li');
        li.className = 'time-item';
        li.textContent = txt;
        ul.appendChild(li);
      });

      wrap.append(h2, ul);
      return wrap;
    }

    function render(sections){
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      (sections || []).forEach(sec => grid.appendChild(createColumn(sec)));
    }

    /* המרה לפי מבנה: A=שם קבוצה, B..N=שעות */
    function tableToSections(table){
      const rows = table.rows || [];
      const sections = [];

      rows.forEach(r => {
        const cells = r.c || [];
        const rawTitle = cellValue(cells[0]).toString().trim();
        const title = rawTitle;
        // דילוג על שורת כותרות/Section
        if (!title || title.toLowerCase() === 'section') return;

        const items = [];
        for (let i = 1; i < cells.length; i++){
          const txt = cellValue(cells[i]).toString().trim();
          if (txt) items.push(txt);
        }
        sections.push({ title, items });
      });

      return sections;
    }

    /* START */
    (async function init(){
      try{
        const table = await loadGvizTable(GVIZ_URL);
        const sections = tableToSections(table);
        render(sections);
      }catch(err){
        console.error(err);
        document.getElementById('grid').innerHTML =
          `<div style="text-align:center;color:#b00;font-weight:700">שגיאה בטעינת הנתונים</div>`;
      }
    })();
  </script>
</body>
</html>
